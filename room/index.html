<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>ì´ˆëŒ€ í™•ì¸ ì¤‘...</title>
</head>
<body>
  <h2>ë°©ì— ì…ì¥í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...</h2>
  <script>
  const urlParams = new URLSearchParams(window.location.search);
  const keyFromUrl = urlParams.get('key');

  if (!keyFromUrl) {
    document.body.innerHTML = '<h2>ğŸš« ìœ íš¨í•˜ì§€ ì•Šì€ ì ‘ê·¼ì…ë‹ˆë‹¤. (key ì—†ìŒ)</h2>';
    throw new Error("key ì—†ìŒ");
  }

  fetch('../latest_id.json?cachebuster=' + Date.now()) // âœ… ìºì‹œ ë°©ì§€!
    .then(response => response.json())
    .then(data => {
      const correctKey = data.key;
      const expiresAt = new Date(data.expiresAt);
      const now = new Date();
      const roomId = data.id;

      if (keyFromUrl !== correctKey) {
        document.body.innerHTML = '<h2>ğŸš« ì´ˆëŒ€ í‚¤ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</h2>';
        return;
      }

      if (now > expiresAt) {
        document.body.innerHTML = '<h2>â° ì´ˆëŒ€ ë§í¬ê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</h2>';
        return;
      }

      window.location.href = `gotaik://chatroom?id=${roomId}`;
    })
    .catch(error => {
      console.error('ğŸš¨ JSON ë¡œë“œ ì˜¤ë¥˜:', error);
      document.body.innerHTML = '<h2>âš ï¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</h2>';
    });
</script>

</body>
</html>
